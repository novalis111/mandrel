<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üé° Spindles Live - AI Thinking Viewer</title>
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: #0a0e14;
        font-family: "JetBrains Mono", monospace;
        color: #d0e0f0;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
      }

      /* Main container */
      .container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        padding: 20px;
      }

      /* Header section */
      .header {
        background: rgba(40, 50, 60, 0.45);
        border-left: 4px solid rgba(108, 186, 239, 0.8);
        border-bottom: 1px solid rgba(108, 186, 239, 0.3);
        border-radius: 4px;
        padding: 20px 30px;
        backdrop-filter: blur(12px);
        box-shadow:
          inset 0 0 15px rgba(108, 186, 239, 0.05),
          inset 2px 2px 4px rgba(255, 255, 255, 0.03),
          inset -2px -2px 4px rgba(0, 0, 0, 0.2);
        position: relative;
        margin-bottom: 20px;
      }

      /* Left light bar with glow */
      .header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: rgba(108, 186, 239, 0.8);
        pointer-events: none;
        box-shadow:
          -16px 0 40px rgba(108, 186, 239, 0.7),
          -10px 0 24px rgba(108, 186, 239, 0.85),
          -5px 0 12px rgba(108, 186, 239, 0.95),
          -2px 0 6px rgba(108, 186, 239, 1);
        animation: light-pulse 3s ease-in-out infinite;
      }

      @keyframes light-pulse {
        0%,
        100% {
          background: rgba(108, 186, 239, 0.8);
          box-shadow:
            -16px 0 40px rgba(108, 186, 239, 0.7),
            -10px 0 24px rgba(108, 186, 239, 0.85),
            -5px 0 12px rgba(108, 186, 239, 0.95),
            -2px 0 6px rgba(108, 186, 239, 1);
        }
        50% {
          background: rgba(108, 186, 239, 1);
          box-shadow:
            -20px 0 50px rgba(108, 186, 239, 0.9),
            -12px 0 30px rgba(108, 186, 239, 1),
            -6px 0 16px rgba(108, 186, 239, 1),
            -3px 0 8px rgba(108, 186, 239, 1);
        }
      }

      .header-title {
        font-size: 28px;
        font-weight: 600;
        color: #d0e0f0;
        text-shadow:
          0 0 4px rgba(208, 224, 240, 0.4),
          0 0 10px rgba(108, 186, 239, 0.3),
          0 0 15px rgba(108, 186, 239, 0.15);
        letter-spacing: 2px;
        margin-bottom: 8px;
      }

      .header-subtitle {
        font-size: 14px;
        font-weight: 400;
        color: #6cbaef;
        letter-spacing: 1px;
        text-shadow:
          0 0 3px rgba(108, 186, 239, 0.5),
          0 0 6px rgba(108, 186, 239, 0.3);
      }

      .stats {
        display: flex;
        gap: 30px;
        margin-top: 12px;
        font-size: 12px;
        color: #8a9db5;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .stat-value {
        color: #6cbaef;
        font-weight: 600;
        text-shadow: 0 0 4px rgba(108, 186, 239, 0.4);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #4ade80;
        box-shadow: 0 0 8px rgba(74, 222, 128, 0.6);
        animation: pulse-dot 2s ease-in-out infinite;
      }

      @keyframes pulse-dot {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.6;
          transform: scale(1.2);
        }
      }

      /* Spindles container */
      .spindles-container {
        flex: 1;
        overflow-y: auto;
        padding-right: 10px;
      }

      /* Custom scrollbar */
      .spindles-container::-webkit-scrollbar {
        width: 8px;
      }

      .spindles-container::-webkit-scrollbar-track {
        background: rgba(40, 50, 60, 0.3);
        border-radius: 4px;
      }

      .spindles-container::-webkit-scrollbar-thumb {
        background: rgba(108, 186, 239, 0.3);
        border-radius: 4px;
      }

      .spindles-container::-webkit-scrollbar-thumb:hover {
        background: rgba(108, 186, 239, 0.5);
      }

      /* Individual spindle card */
      .spindle {
        background: rgba(40, 50, 60, 0.35);
        border-left: 3px solid rgba(108, 186, 239, 0.5);
        border-radius: 4px;
        padding: 16px 20px;
        margin-bottom: 12px;
        backdrop-filter: blur(8px);
        box-shadow:
          inset 0 0 10px rgba(108, 186, 239, 0.03),
          0 2px 8px rgba(0, 0, 0, 0.3);
        animation: slide-in 0.4s ease-out;
        position: relative;
        overflow: hidden;
      }

      @keyframes slide-in {
        from {
          transform: translateX(-20px);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .spindle::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 3px;
        height: 100%;
        background: rgba(108, 186, 239, 0.6);
        box-shadow:
          -8px 0 20px rgba(108, 186, 239, 0.4),
          -4px 0 10px rgba(108, 186, 239, 0.6);
      }

      .spindle-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(108, 186, 239, 0.15);
      }

      .spindle-meta {
        display: flex;
        gap: 16px;
        font-size: 11px;
        color: #6cbaef;
      }

      .spindle-id {
        font-size: 10px;
        color: #5a7a95;
        font-family: monospace;
      }

      .spindle-content {
        color: #c8d9e8;
        line-height: 1.6;
        font-size: 13px;
        font-weight: 400;
      }

      .spindle-time {
        font-size: 11px;
        color: #6cbaef;
        text-shadow: 0 0 4px rgba(108, 186, 239, 0.3);
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #5a7a95;
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
        opacity: 0.4;
      }

      .empty-state-text {
        font-size: 14px;
        letter-spacing: 1px;
      }

      /* Connection status */
      .connection-status {
        font-size: 11px;
        padding: 4px 12px;
        border-radius: 12px;
        background: rgba(74, 222, 128, 0.1);
        border: 1px solid rgba(74, 222, 128, 0.3);
        color: #4ade80;
      }

      .connection-status.disconnected {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
        color: #ef4444;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="header-title">üé° SPINDLES LIVE</div>
        <div class="header-subtitle">
          Real-time AI Thinking Stream Monitor
        </div>
        <div class="stats">
          <div class="stat-item">
            <div class="status-dot"></div>
            <span id="connection-status" class="connection-status"
              >Connecting...</span
            >
          </div>
          <div class="stat-item">
            <span>Total:</span>
            <span class="stat-value" id="total-count">0</span>
          </div>
          <div class="stat-item">
            <span>Session:</span>
            <span class="stat-value" id="session-id">‚Äî</span>
          </div>
        </div>
      </div>

      <!-- Spindles stream -->
      <div class="spindles-container" id="spindles-container">
        <div class="empty-state">
          <div class="empty-state-icon">üé°</div>
          <div class="empty-state-text">
            Waiting for AI thinking blocks...
          </div>
        </div>
      </div>
    </div>

    <script>
      const container = document.getElementById("spindles-container");
      const totalCount = document.getElementById("total-count");
      const sessionId = document.getElementById("session-id");
      const connectionStatus = document.getElementById("connection-status");

      let count = 0;

      // Connect to SSE stream
      const eventSource = new EventSource("/spindles/stream");

      eventSource.onopen = () => {
        console.log("‚úÖ Connected to spindles stream");
        connectionStatus.textContent = "LIVE";
        connectionStatus.classList.remove("disconnected");
      };

      eventSource.onerror = () => {
        console.log("‚ùå Connection error");
        connectionStatus.textContent = "DISCONNECTED";
        connectionStatus.classList.add("disconnected");
      };

      eventSource.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);

          // Handle connection message
          if (data.type === "connected") {
            console.log("üì°", data.message);
            return;
          }

          // Handle spindle data
          if (data.spindle) {
            // Clear empty state on first spindle
            if (count === 0) {
              container.innerHTML = "";
            }

            count++;
            totalCount.textContent = count;

            // Update session ID
            if (data.spindle.sessionId) {
              sessionId.textContent = data.spindle.sessionId.substring(0, 12);
            }

            // Create spindle card
            const spindle = document.createElement("div");
            spindle.className = "spindle";

            const timestamp = new Date(data.spindle.timestamp);
            const timeStr = timestamp.toLocaleTimeString("en-US", {
              hour: "2-digit",
              minute: "2-digit",
              second: "2-digit",
            });

            spindle.innerHTML = `
              <div class="spindle-header">
                <div class="spindle-meta">
                  <span class="spindle-time">‚è±Ô∏è ${timeStr}</span>
                  <span>üí≠ ${data.spindle.type}</span>
                  <span>üìä ~${Math.round(data.spindle.tokenCount)} tokens</span>
                </div>
                <div class="spindle-id">#${data.spindle.id.substring(8, 16)}</div>
              </div>
              <div class="spindle-content">${data.spindle.content}</div>
            `;

            // Add to top of container
            container.insertBefore(spindle, container.firstChild);

            // Keep only last 20 spindles
            while (container.children.length > 20) {
              container.removeChild(container.lastChild);
            }
          }
        } catch (err) {
          console.error("Error parsing spindle:", err);
        }
      };

      // Cleanup on page unload
      window.addEventListener("beforeunload", () => {
        eventSource.close();
      });
    </script>
  </body>
</html>
